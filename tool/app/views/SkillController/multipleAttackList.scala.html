@(skills: Set[model.skill.MultipleAttackSkill], prerequisites: Set[model.skill.Skill])(implicit helper: models.ModelHelper)

@import helper._

@main(title = "/skills/multiple-attack") {
<div class="row">
    <div class="col-xs-12">
        <div class="page-header">
            <h1>/skills/multiple-attack</h1>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-8">
        <div class="row">
            <table class="table table-striped">
                <tr>
                    <th>Id</th>
                    <th>Name</th>
                    <th>Prerequisites</th>
                    <th>Types</th>
                    <th>Elements</th>
                    <th>Power</th>
                    <th>TP</th>
                    <th>Times</th>
                    <th>Range</th>
                    <th>Target</th>
                </tr>
                @for(s <- skills) {
                <tr>
                    <td>@s.getSkill.getSkill.getId.id</td>
                    <td>@s.getSkill.getSkill.name</td>
                    <td>@s.getSkill.getSkill.prerequisites.map(_.name).mkString(",")</td>
                    <td>@s.getSkill.types.map(_.name).mkString(",")</td>
                    <td>@s.getSkill.elements.map(_.name).mkString(",")</td>
                    <td>@s.getSkill.basePower (@s.getSkill.increasingPower%)</td>
                    <td>@s.getSkill.baseTpCost (@s.getSkill.increasingTpCost%)</td>
                    <td>@s.baseTimes (@s.increasingTimes%)</td>
                    <td>@s.range.name</td>
                    <td>@s.target.name</td>
                </tr>
                }
            </table>
        </div>
    </div>
    <div class="col-xs-4">
        <div id="create-result"></div>
        <form>
            <div class="form-group">
                <label for="id">Id</label>
                <input type="text" class="form-control" id="id" placeholder="Skill Id">
            </div>
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" class="form-control" id="name" placeholder="Skill Name">
            </div>
            <div class="form-group">
                <label for="prerequisites">Prerequisites</label>
                <select id="prerequisites" class="form-control" multiple>
                    @for(s <- prerequisites) {
                    <option value="@s.getId.id">@s.name</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="types">Types</label>
                <select id="types" class="form-control" multiple>
                    @for(t <- model.skill.SkillType.values) {
                    <option value="@t.value">@t.name</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="elements">Elements</label>
                <select id="elements" class="form-control" multiple>
                    @for(e <- model.Element.values) {
                    <option value="@e.value">@e.name</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="base-power">Power</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="base-power" placeholder="0">
                    <span class="input-group-addon">%</span>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">L+</span>
                    <input type="number" class="form-control" id="incr-power" placeholder="0">
                    <span class="input-group-addon">%</span>
                </div>
            </div>
            <div class="form-group">
                <label for="base-tp">TP</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="base-tp" placeholder="0">
                    <span class="input-group-addon">TP</span>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">L+</span>
                    <input type="number" class="form-control" id="incr-tp" placeholder="0">
                    <span class="input-group-addon">TP</span>
                </div>
            </div>
            <div class="form-group">
                <label for="base-times">Times</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="base-times" placeholder="0">
                    <span class="input-group-addon">times</span>
                </div>
                <div class="input-group">
                    <span class="input-group-addon">L+</span>
                    <input type="number" class="form-control" id="incr-times" placeholder="0">
                    <span class="input-group-addon">times</span>
                </div>
            </div>
            <div class="form-group">
                <label for="range">Range</label>
                <select id="range" class="form-control">
                    @for(r <- model.Range.values) {
                    <option value="@r.value">@r.name</option>
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="target">Target</label>
                <select id="target" class="form-control">
                    @for(t <- model.Target.values) {
                    <option value="@t.value">@t.name</option>
                    }
                </select>
            </div>
            <button id="create" type="button" class="btn btn-default">Create</button>
        </form>
    </div>
</div>
<script>
    $('#create').click(function() {
        if ($('#types').val() == null) {
            $('#create-result').html('<div class="alert alert-danger" role="alert">types empty</div>');
        }

        if ($('#elements').val() == null) {
            $('#create-result').html('<div class="alert alert-danger" role="alert">elements empty</div>');
        }

        var url = window.location.origin + '@routes.SkillController.createMultipleAttack';
        var id = $('#id').val();
        var name = $('#name').val();
        var prerequisites = $('#prerequisites').val();

        if (prerequisites == null) {
            prerequisites = [];
        }

        var types = $('#types').val().map(parseInt);
        var elements = $('#elements').val().map(parseInt);
        var basePower = parseInt($('#base-power').val());
        var incrPower = parseInt($('#incr-power').val());
        var baseTp = parseInt($('#base-tp').val());
        var incrTp = parseInt($('#incr-tp').val());
        var baseTimes = parseInt($('#base-times').val());
        var incrTimes = parseInt($('#incr-times').val());
        var range = parseInt(parseInt($('#range').val()));
        var target = parseInt(parseInt($('#target').val()));

        fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'text/json'},
            body: JSON.stringify({
                'id': id,
                'name': name,
                'prerequisites': prerequisites,
                'types': types,
                'elements': elements,
                'power': {'base': basePower, 'increasing': incrPower},
                'tp': {'base': baseTp, 'increasing': incrTp},
                'times': {'base': baseTimes, 'increasing': incrTimes},
                'range': range,
                'target': target
            })
        }).then(function(res) {
            if (res.status == 200) {
                window.location.reload(true);
            } else {
                res.json().then(function(json) {
                    $('#create-result').html('<div class="alert alert-danger" role="alert">' + JSON.stringify(json) + '</div>');
                });
            }
        })
    });
</script>
}
